import{h as v}from"./index.0b44bc8f.js";let u;const F=new Uint8Array(16);function C(){if(!u&&(u=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!u))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return u(F)}const o=[];for(let t=0;t<256;++t)o.push((t+256).toString(16).slice(1));function D(t,e=0){return o[t[e+0]]+o[t[e+1]]+o[t[e+2]]+o[t[e+3]]+"-"+o[t[e+4]]+o[t[e+5]]+"-"+o[t[e+6]]+o[t[e+7]]+"-"+o[t[e+8]]+o[t[e+9]]+"-"+o[t[e+10]]+o[t[e+11]]+o[t[e+12]]+o[t[e+13]]+o[t[e+14]]+o[t[e+15]]}const b=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),w={randomUUID:b};function M(t,e,s){if(w.randomUUID&&!e&&!t)return w.randomUUID();t=t||{};const n=t.random||(t.rng||C)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,e){s=s||0;for(let r=0;r<16;++r)e[s+r]=n[r];return e}return D(n)}const E=async t=>{let e=await Promise.all([await v(t).catch(s=>(console.log(s),null))]);return e=e.filter(s=>s).reduce((s,n,r,a)=>s.concat(n),[]),e},N=t=>t.replace(/<\|[a-z]*$/,"").replace(/<\|[a-z]+\|$/,"").replace(/<$/,"").replaceAll(/<\|[a-z]+\|>/g," ").replaceAll(/<br\s?\/?>/gi,`
`).replaceAll("<","&lt;").trim(),z=t=>t.replaceAll("&lt;","<"),V=t=>{let e="";return new TransformStream({transform(s,n){e+=s;const r=e.split(t);r.slice(0,-1).forEach(a=>n.enqueue(a)),e=r[r.length-1]},flush(s){e&&s.enqueue(e)}})},k=t=>{const e={messages:{},currentId:null};let s=null,n=null;for(const r of t)n=M(),s!==null&&(e.messages[s].childrenIds=[...e.messages[s].childrenIds,n]),e.messages[n]={...r,id:n,parentId:s,childrenIds:[]},s=n;return e.currentId=n,e},U=()=>{const t=document.createElement("canvas"),e=t.getContext("2d");t.height=1,t.width=1;const s=new ImageData(t.width,t.height),n=s.data;for(let a=0;a<s.data.length;a+=1)a%4!==3?n[a]=Math.floor(256*Math.random()):n[a]=255;e.putImageData(s,0,0);const r=e.getImageData(0,0,t.width,t.height).data;for(let a=0;a<r.length;a+=1)if(r[a]!==n[a])return console.log("canvasPixelTest: Wrong canvas pixel RGB value detected:",r[a],"at:",a,"expected:",n[a]),console.log("canvasPixelTest: Canvas blocking or spoofing is likely"),!1;return!0},H=t=>{const e=document.createElement("canvas"),s=e.getContext("2d");if(e.width=100,e.height=100,!U())return console.log("generateInitialsImage: failed pixel test, fingerprint evasion is likely. Using default image."),"/user.png";s.fillStyle="#F39C12",s.fillRect(0,0,e.width,e.height),s.fillStyle="#FFFFFF",s.font="40px Helvetica",s.textAlign="center",s.textBaseline="middle";const n=t.trim(),r=n.length>0?n[0]+(n.split(" ").length>1?n[n.lastIndexOf(" ")+1]:""):"";return s.fillText(r.toUpperCase(),e.width/2,e.height/2),e.toDataURL()},O=async t=>{let e=!1;if(!navigator.clipboard){const s=document.createElement("textarea");s.value=t,s.style.top="0",s.style.left="0",s.style.position="fixed",document.body.appendChild(s),s.focus(),s.select();try{const r=document.execCommand("copy")?"successful":"unsuccessful";console.log("Fallback: Copying text command was "+r),e=!0}catch(n){console.error("Fallback: Oops, unable to copy",n)}return document.body.removeChild(s),e}return e=await navigator.clipboard.writeText(t).then(()=>(console.log("Async: Copying to clipboard was successful!"),!0)).catch(s=>(console.error("Async: Could not copy text: ",s),!1)),e},$=(t,e)=>e==="0.0.0"?!1:e.localeCompare(t,void 0,{numeric:!0,sensitivity:"case",caseFirst:"upper"})<0,j=t=>{const e=/\[([^\]]+)\]/g,s=[];let n;for(;(n=e.exec(t))!==null;)s.push({word:n[1],startIndex:n.index,endIndex:e.lastIndex-1});return s},_=t=>{const e=t.split(" "),s=e.findIndex(r=>r.startsWith("#"));return s!==-1&&e.splice(s,1),e.join(" ")},P=t=>t.toLowerCase().replace(/[^\w\s]/g,"").replace(/\s+/g,"-"),W=t=>"mapping"in t[0]?"openai":"webui",R=t=>{var g,p,m,h,f,x,y,I;const e=t.mapping,s=[];let n="",r=null;for(let c in e){const l=e[c];n=c;try{if(s.length==0&&(l.message==null||((g=l.message.content.parts)==null?void 0:g[0])==""&&l.message.content.text==null))continue;{const d={id:c,parentId:r,childrenIds:l.children||[],role:((m=(p=l.message)==null?void 0:p.author)==null?void 0:m.role)!=="user"?"assistant":"user",content:((x=(f=(h=l.message)==null?void 0:h.content)==null?void 0:f.parts)==null?void 0:x[0])||((I=(y=l.message)==null?void 0:y.content)==null?void 0:I.text)||"",model:"gpt-3.5-turbo",done:!0,context:null};s.push(d),r=n}}catch(d){console.log("Error with",l,`
Error:`,d)}}let a={};return s.forEach(c=>a[c.id]=c),{history:{currentId:n,messages:a},models:["gpt-3.5-turbo"],messages:s,options:{},timestamp:t.create_time,title:t.title??"New Chat"}},T=t=>{const e=t.messages;if(e.length===0||e[e.length-1].childrenIds.length!==0||e[0].parentId!==null)return!1;for(let r of e)if(typeof r.content!="string")return!1;return!0},B=t=>{const e=[];let s=0;for(let n of t){const r=R(n);T(r)?e.push({id:n.id,user_id:"",title:n.title,chat:r,timestamp:n.timestamp}):s++}return console.log(s,"Conversations could not be imported"),e},L=t=>{let e;try{e=new URL(t)}catch{return!1}return e.protocol==="http:"||e.protocol==="https:"},A=t=>{const e=/[\uD800-\uDBFF][\uDC00-\uDFFF]|\uD83C[\uDC00-\uDFFF]|\uD83D[\uDC00-\uDE4F]/g;return t.replace(e,"")},q=t=>t.split(new RegExp("(?<=[.!?])")).map(s=>A(s.trim())).filter(s=>s!==""),G=(t,e)=>new File([t],e,{type:t.type}),J=(t,e)=>{t=t.replace(/{{prompt}}/g,e);const s=/{{prompt:start:(\d+)}}/g;let n;for(;(n=s.exec(t))!==null;){const i=parseInt(n[1]);t=t.replace(n[0],e.substring(0,i))}const r=/{{prompt:end:(\d+)}}/g;let a;for(;(a=r.exec(t))!==null;){const i=parseInt(a[1]);t=t.replace(a[0],e.substring(e.length-i))}return t},K=t=>{const e=Math.floor(t/1e9%60),s=Math.floor(t/6e10%60),n=Math.floor(t/36e11%24),r=[];return e>=0&&r.push(`${e}s`),s>0&&r.push(`${s}m`),n>0&&r.push(`${n}h`),r.reverse().join(" ")};export{O as a,$ as b,U as c,W as d,B as e,E as f,H as g,k as h,j as i,L as j,G as k,N as l,K as m,q as n,z as o,J as p,_ as r,V as s,P as t,M as v};
