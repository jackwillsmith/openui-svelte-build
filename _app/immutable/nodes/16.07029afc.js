import{s as ie,a as W,e as $,M as ne,d as p,c as A,i as J,w as T,P as de,p as R,f as y,l as ee,g as b,h as M,m as se,j as I,r as u,n as te,Y as U,t as q}from"../chunks/scheduler.4a29073b.js";import{S as fe,i as me,a as O,t as z,c as ce,f as C,b as ue,d as ge,m as _e,e as pe,g as he}from"../chunks/index.10afcf02.js";import{g as ve}from"../chunks/globals.7f7f1b26.js";import{g as ae}from"../chunks/navigation.88a60950.js";import{p as ye}from"../chunks/stores.455bd7d1.js";import{d as oe}from"../chunks/dayjs.min.37c5e69a.js";import{f as le,i as be,W as Ie,d as we}from"../chunks/index.3cc0610f.js";import{h as Me}from"../chunks/index.1bdba4f5.js";import{H as Ee}from"../chunks/index.56297a3e.js";import{M as Se}from"../chunks/jspdf.es.min.fce916a1.js";import"../chunks/Toaster.svelte_svelte_type_style_lang.622c7c00.js";import"../chunks/create.76372bae.js";import"../chunks/FileSaver.min.898eb36f.js";const{document:G}=ve;function re(s){let f,t,r,n,a,o,m,v,w=oe(s[5].chat.timestamp).format("MMMM D, YYYY")+"",k,E,D,Y,c,d,S,g,B,j,e,i;function F(l){s[13](l)}function K(l){s[14](l)}function N(l){s[15](l)}let V={chatId:s[8],readOnly:!0,selectedModels:s[0],selectedModelfiles:s[4],processing:De,bottomPadding:s[10].length>0,sendPrompt:Ve,continueGeneration:Ye,regenerateResponse:Be};return s[1]!==void 0&&(V.history=s[1]),s[7]!==void 0&&(V.messages=s[7]),s[3]!==void 0&&(V.autoScroll=s[3]),g=new Se({props:V}),R.push(()=>C(g,"history",F)),R.push(()=>C(g,"messages",K)),R.push(()=>C(g,"autoScroll",N)),{c(){f=y("div"),t=y("div"),r=y("div"),n=y("div"),a=y("div"),o=ee(s[6]),m=W(),v=y("div"),k=ee(w),E=W(),D=y("hr"),Y=W(),c=y("div"),d=y("div"),S=y("div"),ue(g.$$.fragment),this.h()},l(l){f=b(l,"DIV",{class:!0});var _=M(f);t=b(_,"DIV",{class:!0});var h=M(t);r=b(h,"DIV",{class:!0});var P=M(r);n=b(P,"DIV",{});var H=M(n);a=b(H,"DIV",{class:!0});var L=M(a);o=se(L,s[6]),L.forEach(p),m=A(H),v=b(H,"DIV",{class:!0});var Q=M(v);k=se(Q,w),Q.forEach(p),H.forEach(p),E=A(P),D=b(P,"HR",{class:!0}),P.forEach(p),Y=A(h),c=b(h,"DIV",{class:!0,id:!0});var X=M(c);d=b(X,"DIV",{class:!0});var Z=M(d);S=b(Z,"DIV",{class:!0});var x=M(S);ge(g.$$.fragment,x),x.forEach(p),Z.forEach(p),X.forEach(p),h.forEach(p),_.forEach(p),this.h()},h(){I(a,"class","text-3xl font-semibold line-clamp-1"),I(v,"class","mt-1 text-gray-400"),I(D,"class","dark:border-gray-800 mt-6 mb-2"),I(r,"class","px-3 w-full max-w-3xl mx-auto"),I(S,"class","py-2"),I(d,"class","h-full w-full flex flex-col py-4"),I(c,"class","flex flex-col justify-center w-full flex-auto overflow-auto h-0"),I(c,"id","messages-container"),I(t,"class","flex flex-col flex-auto justify-center py-8"),I(f,"class","min-h-screen max-h-screen w-full flex flex-col text-gray-700 dark:text-gray-100 bg-white dark:bg-gray-900")},m(l,_){J(l,f,_),u(f,t),u(t,r),u(r,n),u(n,a),u(a,o),u(n,m),u(n,v),u(v,k),u(r,E),u(r,D),u(t,Y),u(t,c),u(c,d),u(d,S),_e(g,S,null),i=!0},p(l,_){(!i||_&64)&&te(o,l[6]),(!i||_&32)&&w!==(w=oe(l[5].chat.timestamp).format("MMMM D, YYYY")+"")&&te(k,w);const h={};_&256&&(h.chatId=l[8]),_&1&&(h.selectedModels=l[0]),_&16&&(h.selectedModelfiles=l[4]),!B&&_&2&&(B=!0,h.history=l[1],U(()=>B=!1)),!j&&_&128&&(j=!0,h.messages=l[7],U(()=>j=!1)),!e&&_&8&&(e=!0,h.autoScroll=l[3],U(()=>e=!1)),g.$set(h)},i(l){i||(O(g.$$.fragment,l),i=!0)},o(l){z(g.$$.fragment,l),i=!1},d(l){l&&p(f),pe(g)}}}function ke(s){let f,t,r,n;G.title=f=`\r
		`+(s[6]?`${s[6].length>30?`${s[6].slice(0,30)}...`:s[6]} | ${s[9]}`:`${s[9]}`)+`\r
	`;let a=s[2]&&re(s);return{c(){t=W(),a&&a.c(),r=$()},l(o){ne("svelte-1123lr8",G.head).forEach(p),t=A(o),a&&a.l(o),r=$()},m(o,m){J(o,t,m),a&&a.m(o,m),J(o,r,m),n=!0},p(o,[m]){(!n||m&576)&&f!==(f=`\r
		`+(o[6]?`${o[6].length>30?`${o[6].slice(0,30)}...`:o[6]} | ${o[9]}`:`${o[9]}`)+`\r
	`)&&(G.title=f),o[2]?a?(a.p(o,m),m&4&&O(a,1)):(a=re(o),a.c(),O(a,1),a.m(r.parentNode,r)):a&&(he(),z(a,1,1,()=>{a=null}),ce())},i(o){n||(O(a),n=!0)},o(o){z(a),n=!1},d(o){o&&(p(t),p(r)),a&&a.d(o)}}}let De="";const Ve=()=>{},Ye=()=>{},Be=()=>{};function je(s,f,t){let r,n,a,o;T(s,le,e=>t(8,r=e)),T(s,ye,e=>t(11,n=e)),T(s,be,e=>t(12,a=e)),T(s,Ie,e=>t(9,o=e)),de("i18n");let m=!1,v=!0,w=[""],k={},E=null,D="",Y=[],c=[],d={messages:{},currentId:null};const S=async()=>{if(await le.set(n.params.id),t(5,E=await Ee(localStorage.token,r).catch(async e=>(await ae("/"),null))),E){const e=E.chat;if(e){console.log(e),t(0,w=((e==null?void 0:e.models)??void 0)!==void 0?e.models:[e.models??""]),t(1,d=((e==null?void 0:e.history)??void 0)!==void 0?e.history:Me(e.messages)),t(6,D=e.title);let i=JSON.parse(localStorage.getItem("settings")??"{}");return await we.set({...i,system:e.system??i.system,options:e.options??i.options}),t(3,v=!0),await q(),c.length>0&&t(1,d.messages[c.at(-1).id].done=!0,d),await q(),!0}else return null}};function g(e){d=e,t(1,d)}function B(e){c=e,t(7,c),t(1,d)}function j(e){v=e,t(3,v)}return s.$$.update=()=>{if(s.$$.dirty&4097&&t(4,k=w.reduce((e,i,F,K)=>{var V;const N=((V=a.filter(l=>l.tagName===i))==null?void 0:V.at(0))??void 0;return{...e,...N&&{[i]:N}}},{})),s.$$.dirty&2)if(d.currentId!==null){let e=[],i=d.messages[d.currentId];for(;i!==null;)e.unshift({...i}),i=i.parentId!==null?d.messages[i.parentId]:null;t(7,c=e)}else t(7,c=[]);s.$$.dirty&2048&&n.params.id&&(async()=>{if(await S()){await q(),t(2,m=!0),window.setTimeout(()=>scrollToBottom(),0);const e=document.getElementById("chat-textarea");e==null||e.focus()}else await ae("/")})()},[w,d,m,v,k,E,D,c,r,o,Y,n,a,g,B,j]}class ze extends fe{constructor(f){super(),me(this,f,je,ke,ie,{})}}export{ze as component};
